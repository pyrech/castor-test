
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://pyrech.github.io/castor-test/03-run/">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.6">
    
    
      
        <title>Executing Processes - Castor documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.558e4712.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.2505c338.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#executing-processes" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Castor documentation" class="md-header__button md-logo" aria-label="Castor documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Castor documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Executing Processes
            
          </span>
        </div>
      </div>
    </div>
    
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/jolicode/castor" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Castor documentation" class="md-nav__button md-logo" aria-label="Castor documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Castor documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/jolicode/castor" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../index.md" class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../01-installation/" class="md-nav__link">
        Installation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../CHANGELOG.md" class="md-nav__link">
        Changelog
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-run-function" class="md-nav__link">
    The run() function
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#process-object" class="md-nav__link">
    Process object
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#failure" class="md-nav__link">
    Failure
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#working-directory" class="md-nav__link">
    Working directory
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#environment-variables" class="md-nav__link">
    Environment variables
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#processing-the-output" class="md-nav__link">
    Processing the output
  </a>
  
    <nav class="md-nav" aria-label="Processing the output">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-capture-function" class="md-nav__link">
    The capture() function
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-exit_code-function" class="md-nav__link">
    The exit_code() function
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#timeout" class="md-nav__link">
    Timeout
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pty-tty" class="md-nav__link">
    PTY &amp; TTY
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  



<h1 id="executing-processes">Executing Processes</h1>
<h2 id="the-run-function">The <code>run()</code> function</h2>
<p>Castor provides a <code>run()</code> function to execute external processes.</p>
<pre><code class="language-php">use Castor\Attribute\AsTask;

use function Castor\run;

#[AsTask()]
function foo(): void
{
    run('echo &quot;bar&quot;');
    run(['echo', 'bar']);
}
</code></pre>
<p>You can pass a string or an array of string for this function. When passing a
string, arguments will not be escaped - use it carefully.</p>
<h2 id="process-object">Process object</h2>
<p>Under the hood, Castor uses the
<a href="https://github.com/symfony/symfony/blob/6.3/src/Symfony/Component/Process/Process.php"><code>Symfony\Component\Process\Process</code></a>
object to execute the process. The <code>run()</code> function will return this object. So
you can use the API of this class to interact with the underlying process:</p>
<pre><code class="language-php">use Castor\Attribute\AsTask;

use function Castor\run;

#[AsTask()]
function foo(): void
{
    $process = run('echo &quot;bar&quot;');
    $process-&gt;isSuccessful(); // will return true
}
</code></pre>
<blockquote>
<p>[!TIP]
Related example: <a href="https://github.com/jolicode/castor/blob/main/examples/run.php">run.php</a></p>
</blockquote>
<h2 id="failure">Failure</h2>
<p>By default, Castor will throw an exception if the process fails. You can disable
that by setting the <code>allowFailure</code> option to <code>true</code>:</p>
<pre><code class="language-php">use Castor\Attribute\AsTask;

use function Castor\run;

#[AsTask()]
function foo(): void
{
    run('a_command_that_does_not_exist', allowFailure: true);
}
</code></pre>
<blockquote>
<p>[!TIP]
Related example: <a href="https://github.com/jolicode/castor/blob/main/examples/failure.php">failure.php</a></p>
</blockquote>
<h2 id="working-directory">Working directory</h2>
<p>By default, Castor will execute the process in the same directory as
the <code>castor.php</code> file. You can change that by setting the <code>path</code> argument. It
can be either a relative or an absolute path:</p>
<pre><code class="language-php">use Castor\Attribute\AsTask;

use function Castor\run;

#[AsTask()]
function foo(): void
{
    run('pwd', path: '../'); // run the process in the parent directory of the castor.php file
    run('pwd', path: '/tmp'); // run the process in the /tmp directory
}
</code></pre>
<blockquote>
<p>[!TIP]
Related example: <a href="https://github.com/jolicode/castor/blob/main/examples/cd.php">cd.php</a></p>
</blockquote>
<h2 id="environment-variables">Environment variables</h2>
<p>By default, Castor will use the same environment variables as the current
process. You can add or override environment variables by setting
the <code>environment</code> argument:</p>
<pre><code class="language-php">use Castor\Attribute\AsTask;

use function Castor\run;

#[AsTask()]
function foo(): void
{
    run('echo $FOO', environment: ['FOO' =&gt; 'bar']); // will print &quot;bar&quot;
}
</code></pre>
<blockquote>
<p>[!TIP]
Related example: <a href="https://github.com/jolicode/castor/blob/main/examples/env.php">env.php</a></p>
</blockquote>
<h2 id="processing-the-output">Processing the output</h2>
<p>By default, Castor will forward the stdout and stderr to the current terminal.
If you do not want to print the process output you can set the <code>quiet</code>
option to <code>true</code>:</p>
<pre><code class="language-php">use Castor\Attribute\AsTask;

use function Castor\run;

#[AsTask()]
function foo(): void
{
    run('echo &quot;bar&quot;', quiet: true); // will not print anything
}
</code></pre>
<p>You can also fetch the process output by using the 
returned <code>Symfony\Component\Process\Process</code> object:</p>
<pre><code class="language-php">use Castor\Attribute\AsTask;

use function Castor\run;

#[AsTask()]
function foo(): void
{
    $process = run('echo &quot;bar&quot;', quiet: true); // will not print anything
    $output = $process-&gt;getOutput(); // will return &quot;bar\n&quot;
}
</code></pre>
<blockquote>
<p>[!TIP]
Related example: <a href="https://github.com/jolicode/castor/blob/main/examples/quiet.php">quiet.php</a></p>
</blockquote>
<h3 id="the-capture-function">The <code>capture()</code> function</h3>
<p>Castor provides a <code>capture()</code> function that will run the process quietly,
trims the output, then returns it:</p>
<pre><code class="language-php">use Castor\Attribute\AsTask;

use function Castor\capture;

#[AsTask()]
function whoami()
{
    $whoami = capture('whoami');

    echo &quot;Hello: $whoami\n&quot;;
}
</code></pre>
<blockquote>
<p>[!TIP]
Related example: <a href="https://github.com/jolicode/castor/blob/main/examples/run.php">run.php</a></p>
</blockquote>
<h3 id="the-exit_code-function">The <code>exit_code()</code> function</h3>
<p>Castor provides a <code>exit_code()</code> function that will run the command, allowing
the process to fail and return its exit code. This is particularly useful when
running tasks on CI as this allows the CI to know if the task failed or not:</p>
<pre><code class="language-php">use Castor\Attribute\AsTask;

use function Castor\exit_code;

#[AsTask()]
function cs(): int
{
    return exit_code('php-cs-fixer fix --dry-run');
}
</code></pre>
<blockquote>
<p>[!TIP]
Related example: <a href="https://github.com/jolicode/castor/blob/main/examples/run.php">run.php</a></p>
</blockquote>
<h2 id="timeout">Timeout</h2>
<p>By default, Castor will use a 60 seconds timeout on all your <code>run()</code> calls.
If you want to tweak that you need to set the <code>timeout</code> argument.</p>
<pre><code class="language-php">use Castor\Attribute\AsTask;

use function Castor\run;

#[AsTask()]
function foo(): void
{
    run('echo &quot;bar&quot;', timeout: 120);
}
</code></pre>
<p>This process will have a 2 minutes timeout. If you want to disable that feature,
you need to set the timeout to <code>0</code>.</p>
<pre><code class="language-php">use Castor\Attribute\AsTask;

use function Castor\run;

#[AsTask()]
function foo(): void
{
    run('echo &quot;bar&quot;', timeout: 0);
}
</code></pre>
<blockquote>
<p>[!TIP]
Related example: <a href="https://github.com/jolicode/castor/blob/main/examples/wait_for.php">wait_for.php</a></p>
</blockquote>
<h2 id="pty-tty">PTY &amp; TTY</h2>
<p>By default, Castor will use a pseudo terminal (PTY) to run the underlying process,
which allows to have nice output in most cases.
For some commands you may want to disable the PTY and use a TTY instead. You can
do that by setting the <code>tty</code> option to <code>true</code>:</p>
<pre><code class="language-php">use Castor\Attribute\AsTask;

use function Castor\run;

#[AsTask()]
function foo(): void
{
    run('echo &quot;bar&quot;', tty: true);
}
</code></pre>
<blockquote>
<p>[!WARNING]
When using a TTY, the output of the command is empty in the process object
(when using <code>getOutput()</code> or <code>getErrorOutput()</code>).</p>
</blockquote>
<p>You can also disable the pty by setting the <code>pty</code> option to <code>false</code>. If <code>pty</code>
and <code>tty</code> are both set to <code>false</code>, the standard input will not be forwarded to
the process:</p>
<pre><code class="language-php">use Castor\Attribute\AsTask;

use function Castor\run;

#[AsTask()]
function foo(): void
{
    run('echo &quot;bar&quot;', pty: false);
}
</code></pre>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.e5c33ebb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.51d95adb.min.js"></script>
      
        <script src="../search/main.js"></script>
      
    
  </body>
</html>